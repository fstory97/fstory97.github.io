---
title: "自動コンテキスト要約"
sidebarTitle: "自動コンパクト"
---

会話がモデルのコンテキストウィンドウ制限に近づくと、Clineは自動的に要約を行い、スペースを空けて作業を継続します。

<Frame>
	<img
		src="https://storage.googleapis.com/cline_public_images/docs/assets/condensing.png"
		alt="Auto-compact feature condensing conversation context"
	/>
</Frame>

## 仕組み

Clineは会話中のトークン使用量を監視します。制限に近づくと、以下を実行します：

1. これまでに起こったすべての包括的な要約を作成
2. 技術的詳細、コード変更、決定事項をすべて保持
3. 会話履歴を要約で置き換え
4. 中断した箇所から正確に継続

この際、要約ツール呼び出しが表示され、チャットビューの他のAPI呼び出しと同様に合計コストが表示されます。

## 重要性

以前は、Clineはコンテキスト制限に達すると古いメッセージを切り捨てていました。これは会話の初期の重要なコンテキストが失われることを意味していました。

要約機能により：
- すべての技術的決定とコードパターンが保持される
- ファイル変更とプロジェクトコンテキストがそのまま残る
- Clineは実行したすべての内容を記憶
- 中断なしでより大きなプロジェクトで作業可能

<Tip>
コンテキスト要約は[フォーカスチェーン](/features/focus-chain)と美しく連携します。フォーカスチェーンが有効な場合、ToDoリストは要約を跨いで持続します。つまり、Clineは複数のコンテキストウィンドウにまたがる長期タスクに取り組みながら、各リセット時にToDoリストに導かれて軌道を維持できます。
</Tip>

## 技術的詳細

要約は、既に使用しているのと同じモデルを使用して、設定されたAPIプロバイダーを通じて実行されます。プロンプトキャッシングを活用してコストを最小化します。

1. Clineは[要約プロンプト](https://github.com/cline/cline/blob/main/src/core/prompts/contextManagement.ts)を使用して会話の要約を要求します。

2. 要約が生成されると、Clineは会話履歴を[継続プロンプト](https://github.com/cline/cline/blob/main/src/core/prompts/contextManagement.ts#L69)で置き換え、Clineに作業の継続を求め、コンテキストとして要約を提供します。

異なるモデルには、自動要約が開始される異なるコンテキストウィンドウ閾値があります。閾値の決定方法は[context-window-utils.ts](https://github.com/cline/cline/blob/main/src/core/context/context-management/context-window-utils.ts)で確認できます。

## コストに関する考慮事項

要約は会話からの既存のプロンプトキャッシュを活用するため、他のツール呼び出しとほぼ同じコストがかかります。

ほとんどの入力トークンは既にキャッシュされているため、主に要約生成（出力トークン）に対して支払うことになり、非常に費用対効果が高くなります。

## チェックポイントによるコンテキスト復元

[チェックポイント](/features/checkpoints)を使用して、要約が発生する前のタスク状態を復元できます。これは、コンテキストを真に失うことがないことを意味します - 常に会話の以前のバージョンにロールバックできます。

<Note>
  要約ツール呼び出しの前のメッセージを編集することは、チェックポイントと同様に機能し、その時点まで会話を復元できます。
</Note>

## 次世代モデルサポート

自動コンパクトは高度なLLMベースの要約を使用し、次世代モデルで大幅に優れた動作をすることが分かっています。現在、以下のモデルでこの機能をサポートしています：

- **Claude 4シリーズ**
- **Gemini 2.5シリーズ**
- **GPT-5**
- **Grok 4**

<Note>
他のモデルを使用する場合、設定で自動コンパクトが有効になっていても、Clineは自動的に標準的なルールベースのコンテキスト切り捨て方法にフォールバックします。
</Note>
