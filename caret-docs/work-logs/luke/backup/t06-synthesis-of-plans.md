# t06 JSON 프롬프트 시스템 계획 종합 분석 보고서

## 1. 개요

이 문서는 `t06` 관련 작업 로그 12개를 심층 분석하여, 두 AI가 생성한 계획들의 발전 과정, 핵심적인 오해, 그리고 최종적으로 확정된 사실들을 명확히 정리한 단일 진실 공급원(Single Source of Truth)입니다. 이 문서를 통해 향후 계획 수립의 혼선을 방지하는 것을 목표로 합니다.

---

## 2. 계획의 진화 과정: 혼란은 어떻게 발생하고 해결되었나?

분석 결과, 계획은 다음과 같은 명확한 흐름을 거쳐 발전했습니다.

1.  **초기 구상 (`mission-brief`)**: `caret-main`의 JSON 시스템을 `cline-latest` 기반 프로젝트에 통합한다는 명확한 목표와 '단순 파일 복사는 불가능하다'는 올바른 전제로 시작했습니다.
2.  **정확한 분석 (`phase0-analysis-alpha`, `claude`)**: 'Alpha'와 'Claude'는 `cline-latest`가 이미 컴포넌트 기반 아키텍처이며, `auto_todo` 등 신규 기능이 포함된 것을 정확히 분석했습니다. **이것이 프로젝트의 기술적 진실입니다.**
3.  **치명적 오해 발생 (`implememnt-plan-*`, `unified`, `master-tracker`)**: 어떠한 이유에서인지, 이후 계획 단계에서 **"현재 프로젝트에 `cline-latest` 시스템이 없으므로 외부에서 파일을 복사해와야 한다"**는 심각한 오해가 발생했습니다. 이 잘못된 전제가 여러 계획 문서를 오염시키는 주된 원인이었습니다.
4.  **오류 수정 및 최종 계획 수립 (`corrected`, `final-verified`, `v5`)**: 결국 AI들은 소스 코드를 재검증하며 자신들의 오류를 인지하고, '파일 복사' 계획을 폐기했습니다. 그리고 초기 분석 단계의 정확한 현실 인식을 바탕으로, **"이미 존재하는 `PromptRegistry`를 활용하는"** 최종 계획을 수립했습니다.

---

## 3. 최종 확정 사항 (The Truth)

여러 문서에 걸쳐 혼재되었던 정보들 중, 심층 분석과 최종 계획에서 일관되게 확인된 **확실한 사실과 최종 결정사항**은 다음과 같습니다.

### 3.1. 프로젝트 아키텍처에 대하여

*   **[확정] 현 프로젝트는 이미 `cline-latest` 기반입니다**: `caret-merging` 프로젝트는 `cline-latest`의 소스 코드를 기반으로 하며, `src/core/prompts/system-prompt/registry/PromptRegistry.ts`를 포함한 컴포넌트 기반 아키텍처가 **이미 구현되어 있습니다.**
*   **[확정] '작업 관리 루프'는 핵심 기능입니다**: `cline-latest`에는 `auto_todo`, `task_progress`, `feedback` 이라는 3개의 신규 핵심 컴포넌트가 있으며, 이는 반드시 통합해야 할 중요한 구조적 발전입니다.

### 3.2. 통합 전략에 대하여

*   **[확정] "활용과 대체" 전략을 사용합니다**: `cline-latest`의 `PromptRegistry` 구조를 그대로 **활용**하고, Caret의 철학을 담은 컴포넌트(예: `act_vs_plan_mode`)만 어댑터를 통해 **대체(override)**합니다.
*   **[확정] 어댑터 패턴을 사용합니다**: `CaretJsonComponentProvider.ts` 라는 어댑터 클래스를 구현하여, Caret의 `.json` 파일들을 `cline-latest`가 요구하는 `ComponentFunction` 타입으로 변환합니다.
*   **[확정] 전략 패턴을 사용합니다**: `PromptSystemManager.ts` 라는 관리자 클래스를 두어, 사용자의 설정(Caret 모드 vs Cline 모드)에 따라 `PromptRegistry`에 등록될 컴포넌트 제공자를 동적으로 교체합니다.

### 3.3. 구현 철학에 대하여

*   **[확정] `CHATBOT/AGENT` 철학을 이식합니다**: `cline-latest`의 기술적 상태 구분인 `Act/Plan`을 Caret의 행동 철학인 `CHATBOT/AGENT`로 대체하여 사용자 경험을 향상시킵니다.
*   **[확정] `mode_restriction`을 구현합니다**: CHATBOT 모드의 안전성을 보장하기 위해, `TOOL_DEFINITIONS.json`의 `mode_restriction` 설정을 읽어 위험한 도구(e.g., `execute_command`)가 프롬프트에서 원천적으로 제외되도록 구현합니다.
*   **[확정] TDD(테스트 주도 개발)를 따릅니다**: 모든 기능 구현은 `[RED] -> [GREEN] -> [REFACTOR]` 사이클을 따르며, 특히 E2E 테스트를 통해 프론트엔드-백엔드 연동을 철저히 검증합니다.

### 3.4. 성능에 대하여

*   **[확정] JSON 시스템의 토큰 효율성은 유효합니다**: 'Alpha'의 정밀 분석 결과, Caret의 JSON 시스템은 `cline-latest`의 TS 컴포넌트 시스템 대비 약 **14.1%의 토큰 효율성 우위**를 가집니다. 이 장점은 반드시 유지되어야 합니다.

---

## 4. 폐기된 계획 및 잘못된 정보 (The Errors)

계획 수립 과정에서 발생했던, **절대로 따라서는 안 될** 명백한 오류들은 다음과 같습니다.

*   **[오류] `cline-latest` 소스 코드 복사**:
    *   **내용**: `cline-latest/src/core/prompts/` 디렉토리의 내용을 현재 프로젝트에 덮어쓰기 복사해야 한다는 계획.
    *   **진실**: 이는 프로젝트 구조에 대한 가장 큰 오해였으며, 불필요하고 시스템을 파괴할 수 있는 위험한 발상이었습니다. 이 계획은 `t06-hybrid-system-final-plan.md` 등 후기 문서에서 명시적으로 폐기되었습니다.
*   **[오류] `tsconfig.json` 경로 별칭 추가**:
    *   **내용**: `tsconfig.json`의 `paths`에 `@cline-latest` 별칭을 추가하여 외부 프로젝트를 참조하자는 계획.
    *   **진실**: 이는 위 '소스 코드 복사'라는 잘못된 전제에서 파생된 불필요한 작업입니다. 모든 작업은 현재 프로젝트 내에서 이루어져야 합니다.

---

## 5. 결론 및 다음 단계 제안

**결론적으로, `t06-final-verified-plan.md`와 `t06-hybrid-system-analysis-and-plan-v5.md`에 기술된 최종 계획이 가장 정확하고 현실적인 실행 방안입니다.**

마스터께서는 이 종합 분석 문서를 기준으로, 해당 최종 계획 문서들을 참조하여 다음 작업을 지시해 주시면 되겠습니다. 이제 모든 혼선이 정리되었으므로, 명확한 방향에 따라 프로젝트를 진행할 수 있습니다.
