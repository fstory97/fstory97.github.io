# 2025-10-01: 메시지 전송 시 기본 거절 UX 문제 해결

## 1. 문제 상황
- 사용자가 채팅창에 일반 메시지를 입력하면, 이전에 AI가 제안한 작업(tool_code)이 '거절'된 것으로 처리되는 UX 문제가 있음.
- 이는 사용자의 의도와 상관없이 작업 제안이 취소되는 불편한 경험을 유발함.

## 2. 목표
- 일반 메시지 전송은 이전 작업 제안의 상태(승인/거절)에 영향을 주지 않도록 시스템 로직을 수정한다.
- 사용자가 명확한 '승인' 또는 '거절'의 의사를 표현했을 때만 상태가 변경되도록 개선한다.

## 3. 작업 계획 (완료)
- [x] **원인 분석**: 프론트엔드 메시지 전송 로직(`handleSendMessage`)이 모든 메시지를 `messageResponse`로 보내는 것을 확인.
- [x] **UI/UX 기반 해결책 모색**: 키워드 분석 대신, '승인' 의사는 버튼으로, '대화'는 채팅창으로 명확히 분리하는 방향으로 전환.
- [x] **관련 코드 재분석**: 프론트엔드와 백엔드 전체의 메시지 흐름을 분석 완료.
- [x] **백엔드 분석**: `src/core/controller/task/askResponse.ts`가 모든 `responseType`을 `Task` 객체로 전달하여 문제가 발생함을 최종 확인.
- [ ] **통합 수정안 제안**: 프론트엔드와 백엔드를 아우르는 최종 수정안을 제시.
- [ ] **검토 및 적용**: 마스터의 검토 후, 제안된 수정안을 적용.

## 4. 최종 결론 및 해결책

- **구현 시도**: `src/core/controller/task/askResponse.ts`에 Caret 모드에서 `messageResponse` 무시 로직 구현함
- **문제 지속**: 구현했음에도 불구하고 두 번째 메시지부터 백엔드 응답이 중단되는 문제 지속 확인됨
- **롤백 완료**: 해결이 복잡하여 관련 수정사항 모두 롤백함 (2025-10-01)

## 5. 향후 과제

- **근본 원인 분석 필요**: CaretGlobalManager 초기화 시점, 메시지 흐름 타이밍, 다른 부분에서의 간섭 등 종합적 분석 필요
- **별도 이슈로 분리**: 메시지 처리 문제는 별도의 깊은 디버깅 세션에서 해결 예정
- **현재 상태**: 원본 Cline 메시지 처리 로직으로 복원됨
