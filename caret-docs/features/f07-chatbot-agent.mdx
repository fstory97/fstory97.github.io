# Chatbot/Agent ëª¨ë“œ (f07) - ì‚¬ìš©ì ê²½í—˜ ë ˆì´ì–´

**ì—­í• **: ì§ê´€ì ì´ê³  ìì—°ìŠ¤ëŸ¬ìš´ **ì‚¬ìš©ì ê²½í—˜**ì„ ì œê³µí•˜ëŠ” ì¸í„°í˜ì´ìŠ¤ ë ˆì´ì–´  
**ë°©ì‹**: f06 ê¸°ìˆ  ì¸í”„ë¼ë¥¼ í™œìš©í•œ **ëŒ€ì²´í’ˆ ë°©ì‹**ìœ¼ë¡œ ì•ˆì „í•œ êµ¬í˜„  
**êµ¬í˜„ ìƒíƒœ**: âœ… **ì™„ë£Œ** - f06ê³¼ í•¨ê»˜ í•˜ì´ë¸Œë¦¬ë“œ ë°©ì‹ìœ¼ë¡œ ìš´ì˜ ì¤‘

## ğŸ¤” **Plan/Act vs Chatbot/Agent - í•µì‹¬ ì°¨ì´ì **

### **1. ì‚¬ìš©ì ê²½í—˜ ì°¨ì´**

| êµ¬ë¶„            | Cline Plan/Act               | Caret Chatbot/Agent              |
| --------------- | ---------------------------- | -------------------------------- |
| **ê²½í—˜ ë°©ì‹**   | ë¶„ì ˆëœ ê²½í—˜ (ê³„íšâ†’ìŠ¹ì¸â†’ì‹¤í–‰) | ë‹¨ì¼ ì—°ì† ê²½í—˜ (ìì—°ìŠ¤ëŸ¬ìš´ ëŒ€í™”) |
| **AI ì—­í• **     | ë„êµ¬ ì‚¬ìš© ì¤‘ì‹¬               | ëŒ€í™”ì™€ í˜‘ì—… ì¤‘ì‹¬                 |
| **ì‚¬ìš©ì ê´€ì ** | ê¸°ìˆ ì  ìš©ì–´ (Plan/Act)       | ì§ê´€ì  ìš©ì–´ (Chatbot/Agent)      |

### **2. AI í–‰ë™ íŒ¨í„´ ê°œì„  (v2)**

Caret AIì˜ í˜ë¥´ì†Œë‚˜ëŠ” **"ì²´ê³„ì ì´ê³  í˜‘ë ¥ì ì¸ ì†Œí”„íŠ¸ì›¨ì–´ ì—”ì§€ë‹ˆì–´"**ë¡œ í†µì¼ë©ë‹ˆë‹¤. ê° ëª¨ë“œëŠ” ì´ í˜ë¥´ì†Œë‚˜ë¥¼ ê¸°ë°˜ìœ¼ë¡œ í–‰ë™ íŒ¨í„´ë§Œ ë‹¬ë¦¬í•©ë‹ˆë‹¤.

#### **ğŸ¤– Chatbot Mode (ê°œë°œì ì¡°ë ¥ì)**

- **ì—­í• **: ë³€ê²½ ì‘ì—…ì„ ì§ì ‘ ìˆ˜í–‰í•˜ë ¤ëŠ” ê°œë°œìë¥¼ ë³´ì¡°í•©ë‹ˆë‹¤.
- **í•µì‹¬ ì§€ì¹¨**:
  - ì² ì €í•œ ë¶„ì„, ì½”ë“œ ì œì•ˆ, êµ¬í˜„ ê³„íš ì„¤ëª…ì„ ì œê³µí•©ë‹ˆë‹¤.
  - **ì ˆëŒ€** íŒŒì¼ ìˆ˜ì •ì´ë‚˜ ëª…ë ¹ì„ ì‹¤í–‰í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. (ì½ê¸° ì „ìš©)

#### **âš¡ Agent Mode (í˜‘ë ¥ì  ì‹¤í–‰ì)**

- **ì—­í• **: ì‚¬ìš©ìì™€ í˜‘ë ¥í•˜ì—¬ ììœ¨ì ìœ¼ë¡œ ì‘ì—…ì„ ì‹¤í–‰í•©ë‹ˆë‹¤.
- **í•µì‹¬ ì§€ì¹¨**:
  - **ëª…ì‹œì ì¸ ì‚¬ìš©ì ì§€ì‹œê°€ ìˆì„ ë•Œë§Œ** ì‘ì—…ì„ ì‹¤í–‰í•©ë‹ˆë‹¤.
  - ì‘ì—… ì¤‘ ì‚¬ìš©ìê°€ ì¤‘ì§€, í™”ì œ ì „í™˜, ë¶„ì„ì„ ìš”ì²­í•˜ë©´ **í•­ìƒ** ì‹¤í–‰ì„ ë©ˆì¶”ê³  ë‹¤ìŒ ì§€ì‹œë¥¼ ê¸°ë‹¤ë¦½ë‹ˆë‹¤. (í™”ì œ ì „í™˜ = ìµœìš°ì„  ì§€ì‹œ)
  - ëª¨ë“  ë³€ê²½ ì „, ì‹ ì¤‘í•˜ê²Œ ë¶„ì„í•˜ê³  ì‚¬ìš©ìì™€ ê³„íšì„ í™•ì¸í•©ë‹ˆë‹¤.

## ğŸ—ï¸ **f06+f07 í•˜ì´ë¸Œë¦¬ë“œ ì•„í‚¤í…ì²˜: ëŒ€ì²´í’ˆ ë°©ì‹**

### **í•µì‹¬ ì„¤ê³„ ì›ì¹™**

í˜„ì¬ êµ¬í˜„ëœ ëŒ€ì²´í’ˆ ë°©ì‹ì˜ í•µì‹¬ êµ¬ì¡°:

```typescript
// system-prompt/index.tsì˜ ì‹¤ì œ ë¶„ê¸° ë¡œì§
if (currentMode === "caret") {
    const { CaretPromptWrapper } = await import("@caret/core/prompts/CaretPromptWrapper")
    return await CaretPromptWrapper.getCaretSystemPrompt(context)
} else {
    return await registry.get(context) // ê¸°ì¡´ Cline 100% ë³´ì¡´
}
```

### **ìµœì†Œ ì¹¨ìŠµ êµ¬í˜„**
- **ìˆ˜ì •ëœ íŒŒì¼**: 3ê°œ í•µì‹¬ íŒŒì¼ë§Œ
- **ê¸°ìˆ  ì¬í™œìš©**: Cline plan/act ì¸í”„ë¼ ê·¸ëŒ€ë¡œ í™œìš©
- **ì˜ë¯¸ë¡ ì  í•´ì„**: ë™ì¼í•œ ê¸°ìˆ ì„ ë‹¤ë¥¸ ìš©ì–´ë¡œ í‘œí˜„

## ğŸ“‹ **êµ¬ì²´ì  ê¸°ëŠ¥ ì°¨ì´**

### **ğŸ¤– Chatbot Mode - ì•ˆì „í•œ AI ìƒë‹´ì‚¬**

#### **í—ˆìš©ë˜ëŠ” ê¸°ëŠ¥**

- âœ… **íŒŒì¼ ì½ê¸°**: ì½”ë“œ ë¶„ì„, ë¬¸ì„œ ê²€í†  (`read_file`, `search_files`)
- âœ… **ììœ  ëŒ€í™”**: ì§ˆë¬¸-ë‹µë³€, ê¸°ìˆ  ìƒë‹´, ì„¤ëª… ìš”ì²­
- âœ… **ì›¹ ê²€ìƒ‰**: ìë£Œ ì¡°ì‚¬, ë¬¸ì„œ ì°¸ì¡° (`browse_web`)

#### **ì°¨ë‹¨ë˜ëŠ” ê¸°ëŠ¥**

- âŒ **íŒŒì¼ ìˆ˜ì •**: `write_to_file`, `replace_in_file` ì™„ì „ ì°¨ë‹¨
- âŒ **ëª…ë ¹ ì‹¤í–‰**: `execute_command` ì°¨ë‹¨ìœ¼ë¡œ í„°ë¯¸ë„ ëª…ë ¹ ë¶ˆê°€
- âŒ **ìœ„í—˜ ì‘ì—…**: ì‹œìŠ¤í…œ ë³€ê²½ ê°€ëŠ¥í•œ ëª¨ë“  ë„êµ¬ ì œí•œ

### **âš¡ Agent Mode - ëŠ¥ë™ì  AI ê°œë°œ íŒŒíŠ¸ë„ˆ**

#### **ëª¨ë“  ê¸°ëŠ¥ í—ˆìš©**

- âœ… **ì½ê¸° + ì“°ê¸°**: íŒŒì¼ ë¶„ì„ë¶€í„° ìˆ˜ì •ê¹Œì§€ ì „ì²´ ê³¼ì •
- âœ… **ì‹¤í–‰**: ë¹Œë“œ, í…ŒìŠ¤íŠ¸, ì„œë²„ ì‹¤í–‰ ë“± ëª…ë ¹ì–´ ìˆ˜í–‰
- âœ… **ëŒ€í™”**: ì‘ì—… ì¤‘ ìì—°ìŠ¤ëŸ¬ìš´ ì†Œí†µê³¼ ì§ˆë¬¸ ê°€ëŠ¥

### **ğŸ›¡ï¸ ë„êµ¬ ì œí•œ ì‹œìŠ¤í…œ**

í˜„ì¬ êµ¬í˜„ëœ ë„êµ¬ ì œí•œ ë¡œì§:

```typescript
// CaretModeManager.tsì˜ ì‹¤ì œ êµ¬í˜„
static isToolAllowed(toolName: string): boolean {
    const allowed = this.caretMode === "agent" || (() => {
        if (this.caretMode === "chatbot") {
            // CHATBOT ëª¨ë“œ: ì½ê¸° ì „ìš© ë„êµ¬ë§Œ
            const allowedInChatbot = [
                "read_file", "list_files", "search_files",
                "list_code_definition_names", "ask_followup_question",
                "web_fetch", "attempt_completion"
            ]
            return allowedInChatbot.includes(toolName)
        }
        return false
    })()
    
    return allowed
}
```

## ğŸ”§ **ì‹¤ì œ êµ¬í˜„ëœ ì•„í‚¤í…ì²˜**

### **í•µì‹¬ ì»´í¬ë„ŒíŠ¸**

```typescript
// 1. ëª¨ë“œ ìƒíƒœ ê´€ë¦¬ (globalState ê¸°ë°˜)
export class CaretModeManager {
    private static caretMode: "chatbot" | "agent" = "agent"
    private static context: vscode.ExtensionContext

    static async initialize(): Promise<void> {
        const savedMode = this.context.globalState.get<"chatbot" | "agent">("caret.mode", "agent")
        this.caretMode = savedMode
    }

    static async setCaretMode(mode: "chatbot" | "agent"): Promise<void> {
        this.caretMode = mode
        await this.context.globalState.update("caret.mode", mode)
    }
}

// 2. í”„ë¡¬í”„íŠ¸ ìƒì„± ì‹œìŠ¤í…œ
export class CaretPromptWrapper {
    static async getCaretSystemPrompt(context: SystemPromptContext): Promise<string> {
        const caretMode = CaretModeManager.getCurrentCaretMode()
        const caretModeConstant = caretMode === "chatbot" ? CARET_MODES.CHATBOT : CARET_MODES.AGENT
        
        return await this.promptManager.getPrompt({
            ...context,
            mode: caretModeConstant
        })
    }
}

// 3. gRPC ì„œë¹„ìŠ¤ (ì›¹ë·° í†µì‹ )
export async function SetCaretMode(
    controller: Controller,
    request: proto.caret.SetCaretModeRequest,
): Promise<proto.caret.SetCaretModeResponse> {
    await CaretModeManager.setCaretMode(request.mode)
    return { success: true, currentMode: request.mode }
}
```

### **UI ë™ê¸°í™”**

```typescript
// ExtensionStateContext.tsxì˜ localStorage ë™ê¸°í™”
if (newState.modeSystem !== undefined) {
    localStorage.setItem("caret.modeSystem", newState.modeSystem)
}
if (newState.mode !== undefined) {
    localStorage.setItem("caret.mode", newState.mode)
}
```

## ğŸ”„ **Cline í˜¸í™˜ì„±**

### **ì™„ì „ í˜¸í™˜ì„± ì œê³µ**

| Caret Mode     | Cline Mode  | ì„¤ëª…           |
| -------------- | ----------- | -------------- |
| **ğŸ’¬ Chatbot** | **ğŸ“‹ Plan** | ëŒ€í™”/ê³„íš ì¤‘ì‹¬ |
| **ğŸ¤– Agent**   | **âš¡ Act**  | ì‹¤í–‰/ì‘ì—… ì¤‘ì‹¬ |

### **ë§¤ë„ëŸ¬ìš´ ì „í™˜**

- **ê¸°ì¡´ ì‚¬ìš©ì**: ì•„ë¬´ëŸ° ë³€ê²½ ì—†ì´ Plan/Act ëª¨ë“œ ê³„ì† ì‚¬ìš©
- **ìƒˆë¡œìš´ ì‚¬ìš©ì**: ì§ê´€ì ì¸ Chatbot/Agent ëª¨ë“œ í™œìš©
- **í˜¼í•© ì‚¬ìš©**: ì–¸ì œë“ ì§€ Caret â†” Cline ëª¨ë“œ ì „í™˜ ê°€ëŠ¥

## ğŸ“Š **í˜„ì¬ êµ¬í˜„ í˜„í™©**

### **âœ… ì™„ë£Œëœ í•µì‹¬ ê¸°ëŠ¥**

| ì»´í¬ë„ŒíŠ¸ | êµ¬í˜„ ìƒíƒœ | ì„¤ëª… |
|----------|-----------|------|
| **ëª¨ë“œ ê´€ë¦¬** | âœ… ì™„ë£Œ | CaretModeManager (globalState ê¸°ë°˜) |
| **ë„êµ¬ ì œí•œ** | âœ… ì™„ë£Œ | isToolAllowed ë©”ì„œë“œë¡œ ì•ˆì „ ì œì–´ |
| **í”„ë¡¬í”„íŠ¸** | âœ… ì™„ë£Œ | CaretPromptWrapper ë…ë¦½ ìƒì„± |
| **gRPC í†µì‹ ** | âœ… ì™„ë£Œ | SetCaretMode/GetCaretMode ì„œë¹„ìŠ¤ |
| **UI ë™ê¸°í™”** | âœ… ì™„ë£Œ | ExtensionStateContext localStorage |
| **Cline ë³´ì¡´** | âœ… ì™„ë£Œ | ê¸°ì¡´ ì›Œí¬í”Œë¡œìš° 100% ìœ ì§€ |

### **ğŸ¯ ì‚¬ìš© ë°©ë²•**

#### **ëª¨ë“œ ì „í™˜**
1. **ë‹¨ì¶•í‚¤**: `âŒ˜â‡§A` (macOS) ë˜ëŠ” `Ctrl+Shift+A` (Windows/Linux)
2. **UI í† ê¸€**: ì±„íŒ… ì…ë ¥ì°½ ìƒë‹¨ì˜ ëª¨ë“œ í† ê¸€ ë²„íŠ¼
3. **ì„¤ì •**: Caret â†” Cline ì‹œìŠ¤í…œ ì „í™˜

#### **Chatbot ëª¨ë“œ í™œìš©**
- "ì´ í•¨ìˆ˜ì˜ ì„±ëŠ¥ ë¬¸ì œì ì„ ë¶„ì„í•´ì¤˜"
- "ì½”ë“œ ìŠ¤íƒ€ì¼ ê´€ì ì—ì„œ ë¦¬ë·°í•´ì¤˜"
- "ì´ ì•„í‚¤í…ì²˜ì˜ ì¥ë‹¨ì ì„ ì„¤ëª…í•´ì¤˜"

#### **Agent ëª¨ë“œ í™œìš©**
- "ì‚¬ìš©ì ì¸ì¦ ì‹œìŠ¤í…œì„ JWTë¡œ êµ¬í˜„í•´ì¤˜"
- "ì´ ë²„ê·¸ë¥¼ ì°¾ì•„ì„œ ìˆ˜ì •í•˜ê³  í…ŒìŠ¤íŠ¸ê¹Œì§€ ì™„ë£Œí•´ì¤˜"
- "í”„ë¡œì íŠ¸ë¥¼ Next.jsë¡œ ì„¤ì •í•˜ê³  ì´ˆê¸° êµ¬ì¡° ìƒì„±í•´ì¤˜"

## ğŸ—ï¸ **ê¸°ìˆ ì  íŠ¹ì§•**

### **1. ë‹¨ì¼ ê²½ë¡œ í†µí•©**
- **globalState**: ëª¨ë“  ìƒíƒœë¥¼ VS Code globalStateë¡œ í†µí•©
- **ì¤‘ë³µ ì œê±°**: localStorageì™€ globalState ë™ê¸°í™”ë¡œ ì¼ê´€ì„± í™•ë³´
- **ìµœì†Œ ìˆ˜ì •**: 3ê°œ íŒŒì¼ë§Œ ë³€ê²½ìœ¼ë¡œ Cline ì•ˆì •ì„± ë³´ì¥

### **2. ì™„ì „í•œ ë¶„ë¦¬**
- **ë…ë¦½ ë””ë ‰í† ë¦¬**: caret-srcì—ì„œ ëª¨ë“  Caret ë¡œì§ ê´€ë¦¬
- **ë¶„ê¸° ìµœì†Œí™”**: system-prompt/index.tsì—ì„œ ë‹¨ì¼ ë¶„ê¸°ì 
- **í›„ì§„ í˜¸í™˜**: ê¸°ì¡´ Cline ì‚¬ìš©ì ì›Œí¬í”Œë¡œìš° 100% ë³´ì¡´

---

## ğŸ”— **ê´€ë ¨ ë¬¸ì„œ**

- **[f06-json-system-prompt.mdx](./f06-json-system-prompt.mdx)**: ê¸°ìˆ  ì¸í”„ë¼ ë ˆì´ì–´
- **[caret-architecture-and-implementation-guide.mdx](../development/caret-architecture-and-implementation-guide.mdx)**: ì „ì²´ ì•„í‚¤í…ì²˜ ê°€ì´ë“œ
